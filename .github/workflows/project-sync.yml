name: Project Sync

on:
  issues:
    types: [opened, closed, assigned, unassigned, labeled, unlabeled]
  pull_request:
    types: [opened, closed, ready_for_review]
  schedule:
    - cron: "*/15 * * * *" # Run every 15 minutes

permissions:
  issues: write
  pull-requests: write
  repository-projects: write
  contents: read

jobs:
  sync-project-board:
    name: Sync Project Board
    runs-on: ubuntu-latest
    steps:
      - name: Sync issues to project board
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // This workflow handles project board automation
            // It will move issues and PRs between columns based on their state
            
            if (context.eventName === 'issues') {
              const issue = context.payload.issue;
              const action = context.payload.action;
              
              console.log(`Issue #${issue.number} was ${action}`);
              
              // Handle different issue actions
              switch(action) {
                case 'opened':
                  // New issues go to To Do
                  console.log(`New issue #${issue.number} created`);
                  break;
                  
                case 'closed':
                  // Closed issues go to Done
                  console.log(`Issue #${issue.number} closed`);
                  break;
                  
                case 'assigned':
                  // Assigned issues go to In Progress
                  console.log(`Issue #${issue.number} assigned to ${issue.assignee.login}`);
                  break;
                  
                case 'unassigned':
                  // Unassigned issues go to To Do
                  console.log(`Issue #${issue.number} unassigned`);
                  break;
              }
            }
            
            if (context.eventName === 'pull_request') {
              const pr = context.payload.pull_request;
              const action = context.payload.action;
              
              console.log(`PR #${pr.number} was ${action}`);
              
              // Handle different PR actions
              switch(action) {
                case 'opened':
                  // New PRs go to In Review
                  console.log(`New PR #${pr.number} created`);
                  break;
                  
                case 'closed':
                  // Merged PRs go to Done
                  if (pr.merged) {
                    console.log(`PR #${pr.number} merged`);
                  } else {
                    console.log(`PR #${pr.number} closed without merge`);
                  }
                  break;
                  
                case 'ready_for_review':
                  // PRs ready for review go to In Review
                  console.log(`PR #${pr.number} ready for review`);
                  break;
              }
            }